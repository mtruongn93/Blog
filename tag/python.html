<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Minh Truong | articles tagged "python"</title>
    <link rel="shortcut icon" type="image/png" href="https://mtruongn93.github.io/blog/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://mtruongn93.github.io/blog/favicon.ico">
    <link href="https://mtruongn93.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Minh Truong Full Atom Feed" />
    <link rel="stylesheet" href="https://mtruongn93.github.io/blog/theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="https://mtruongn93.github.io/blog/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://mtruongn93.github.io/blog/theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Minh" />
</head>
<body>
    <header>
        <nav>
            <ul>
                <li class="ephemeral selected"><a href="https://mtruongn93.github.io/blog/tag/python.html">python</a></li>
                <li><a href="https://mtruongn93.github.io/blog/">Home</a></li>
                <li><a href="https://mtruongn93.github.io/blog">Blog</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="https://mtruongn93.github.io/blog/">Minh Truong</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Jul 15, 2019</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://mtruongn93.github.io/blog/blog-3.html" rel="bookmark" title="Permanent Link to &quot;Alternative for confusing RegEx&quot;">Alternative for confusing RegEx</a>
                </h2>

                
                

                <p>RegEx (aka Regular Expression) is a tool for people to match a certain string in a huge text. This is extremely useful for people doing Text Analytics or Natural Language Processing. However, it is extremely confusing and hard to use as it has so many irregular meta-characters. Luckily, another package was created to help with this problem. It is called <strong>VerbalExpression</strong></p>
<h2>RegEx</h2>
<ul>
<li>Before we talk about VerbalExpression, let's review about the basic Regular Expression first</li>
</ul>
<div class="highlight"><pre><span></span><span class="o">[</span><span class="n">az</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">either</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">z</span><span class="w"></span>
<span class="o">[</span><span class="n">a-z</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">characters</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">z</span><span class="w"></span>
<span class="o">[</span><span class="n">A-Z</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">characters</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">Z</span><span class="w"></span>
<span class="o">[</span><span class="n">a-zA-Z</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">characters</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">Z</span><span class="w"></span>
<span class="o">[</span><span class="n">1-4</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="o">[</span><span class="n">^a-z</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">characters</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">z</span><span class="w"></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">^</span> <span class="o">-</span> <span class="nv">Matches</span> <span class="nv">the</span> <span class="nv">start</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">line</span>
$ <span class="o">-</span> <span class="nv">Matches</span> <span class="nv">the</span> <span class="k">end</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">line</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">*</span> <span class="o">-</span> <span class="n">Zero</span> <span class="k">or</span> <span class="k">more</span>
<span class="o">+</span> <span class="o">-</span> <span class="n">One</span> <span class="k">or</span> <span class="k">more</span>
<span class="o">?</span> <span class="o">-</span> <span class="n">Zero</span> <span class="k">or</span> <span class="n">one</span>
<span class="err">{</span><span class="n">n</span><span class="err">}</span> <span class="o">-</span> <span class="n">Exactly</span> <span class="s1">&#39;n&#39;</span> <span class="nb">number</span>
<span class="err">{</span><span class="n">n</span><span class="p">,</span><span class="err">}</span> <span class="o">-</span> <span class="n">Matches</span> <span class="s1">&#39;n&#39;</span> <span class="k">or</span> <span class="k">more</span> <span class="n">occurrences</span>
<span class="err">{</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="err">}</span> <span class="o">-</span> <span class="k">Between</span> <span class="s1">&#39;n&#39;</span> <span class="k">and</span> <span class="s1">&#39;m&#39;</span>
</pre></div>


<ul>
<li>As we can see, there are so many things for us to remember to use Regular Expression. For me, most of the time, I need to Google or to use StackOverflow to check for any Regex questions.</li>
<li>Luckily, we can use VerbalExpressions package to help us with this process.</li>
</ul>
<h2>VerbalExpressions</h2>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">verbalexpressions</span> <span class="kn">import</span> <span class="n">VerEx</span>
</pre></div>


<ul>
<li>Let's start with the range in RegEx. We can easily replace this with <code>.range()</code></li>
</ul>
<div class="highlight"><pre><span></span><span class="n">verbal_expression</span><span class="p">.</span><span class="k">range</span><span class="p">(</span><span class="ss">&quot;az&quot;</span><span class="p">)</span><span class="w">            </span><span class="c1">--&gt; [az]</span>
<span class="n">verbal_expression</span><span class="p">.</span><span class="k">range</span><span class="p">(</span><span class="ss">&quot;a&quot;</span><span class="p">,</span><span class="ss">&quot;z&quot;</span><span class="p">)</span><span class="w">         </span><span class="c1">--&gt; [a-z]</span>
<span class="n">verbal_expression</span><span class="p">.</span><span class="k">range</span><span class="p">(</span><span class="ss">&quot;A&quot;</span><span class="p">,</span><span class="ss">&quot;Z&quot;</span><span class="p">)</span><span class="w">         </span><span class="c1">--&gt; [A-Z]</span>
<span class="n">verbal_expression</span><span class="p">.</span><span class="k">range</span><span class="p">(</span><span class="ss">&quot;a&quot;</span><span class="p">,</span><span class="ss">&quot;z&quot;</span><span class="p">,</span><span class="ss">&quot;A&quot;</span><span class="p">,</span><span class="ss">&quot;Z&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">--&gt; [a-zA-Z]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;a b c A B D 1 2 3 ab&quot;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">verbal_expression</span> <span class="o">=</span> <span class="n">VerEx</span><span class="p">()</span>
<span class="n">verbal_expression</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">verbal_expression</span><span class="o">.</span><span class="n">source</span><span class="p">())</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">verbal_expression</span><span class="o">.</span><span class="n">source</span><span class="p">(),</span><span class="n">string</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">([</span><span class="n">a</span><span class="o">-</span><span class="k">c</span><span class="p">])</span>

<span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">verbal_expression</span> <span class="o">=</span> <span class="n">VerEx</span><span class="p">()</span>
<span class="n">verbal_expression</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">verbal_expression</span><span class="o">.</span><span class="n">source</span><span class="p">())</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">verbal_expression</span><span class="o">.</span><span class="n">source</span><span class="p">(),</span><span class="n">string</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">([</span><span class="n">A</span><span class="o">-</span><span class="k">C</span><span class="p">])</span>

<span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">verbal_expression</span> <span class="o">=</span> <span class="n">VerEx</span><span class="p">()</span>
<span class="n">verbal_expression</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;c&quot;</span><span class="p">,</span><span class="s2">&quot;A&quot;</span><span class="p">,</span><span class="s2">&quot;C&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">verbal_expression</span><span class="o">.</span><span class="n">source</span><span class="p">())</span>
<span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">verbal_expression</span><span class="o">.</span><span class="n">source</span><span class="p">(),</span><span class="n">string</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">([</span><span class="n">a</span><span class="o">-</span><span class="n">cA</span><span class="o">-</span><span class="n">C1</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

<span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
</pre></div>


<ul>
<li>We can also define matches start of or end of the line with VerbalExpression</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">verbal_expression</span><span class="p">.</span><span class="n">start_of_line</span><span class="p">()</span> <span class="c1">--&gt; ^</span>
<span class="n">verbal_expression</span><span class="p">.</span><span class="n">end_of_line</span><span class="p">()</span>   <span class="c1">--&gt; $</span>
</pre></div>


<ul>
<li>In addition, we also can state which words that we want to have, which words we may want to have. We can also exclude the words that we don't want.</li>
</ul>
<div class="highlight"><pre><span></span><span class="nv">verbal_expression</span>.<span class="nv">find</span><span class="ss">()</span>          <span class="o">--&gt;</span> <span class="nv">find</span> <span class="nv">a</span> <span class="nv">string</span>
<span class="nv">verbal_expression</span>.<span class="nv">maybe</span><span class="ss">()</span>         <span class="o">--&gt;</span> <span class="nv">maybe</span> <span class="nv">find</span> <span class="nv">a</span> <span class="nv">string</span>
<span class="nv">verbal_expression</span>.<span class="nv">anything_but</span><span class="ss">()</span>  <span class="o">--&gt;</span> <span class="nv">exclude</span> <span class="nv">strings</span> <span class="nv">we</span> <span class="k">do</span> <span class="nv">not</span> <span class="nv">want</span>
</pre></div>


<ul>
<li>Let's try to look for a correct url link.</li>
</ul>
<div class="highlight"><pre><span></span>  <span class="o">+</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">google</span><span class="p">.</span><span class="n">com</span>
  <span class="o">+</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span>
  <span class="o">+</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">google</span><span class="p">.</span><span class="n">com</span>
  <span class="o">+</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span>
  <span class="o">+</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">doodles</span><span class="o">/</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">verbal_expression</span> <span class="o">=</span> <span class="n">VerEx</span><span class="p">()</span>
<span class="n">tester</span> <span class="o">=</span> <span class="p">(</span><span class="n">verbal_expression</span><span class="o">.</span>
            <span class="n">start_of_line</span><span class="p">()</span><span class="o">.</span>
            <span class="n">find</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">)</span><span class="o">.</span>
            <span class="n">maybe</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span><span class="o">.</span>
            <span class="n">find</span><span class="p">(</span><span class="s1">&#39;://&#39;</span><span class="p">)</span><span class="o">.</span>
            <span class="n">maybe</span><span class="p">(</span><span class="s1">&#39;www.&#39;</span><span class="p">)</span><span class="o">.</span>
            <span class="n">anything_but</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span>
            <span class="n">end_of_line</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># The RegEx syntax if we do it by ourself</span>
<span class="k">print</span><span class="p">(</span><span class="n">tester</span><span class="o">.</span><span class="n">source</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">^</span><span class="p">(</span><span class="n">http</span><span class="p">)(</span><span class="n">s</span><span class="p">)</span><span class="o">?</span><span class="p">(:</span><span class="o">//</span><span class="p">)(</span><span class="n">www</span><span class="err">\</span><span class="p">.)</span><span class="o">?</span><span class="p">([</span><span class="o">^</span><span class="err">\</span> <span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="err">$</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Create an example URL</span>
<span class="n">test_url</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;http://www.google.com&quot;</span><span class="p">,</span> <span class="s2">&quot;https://www.google.com&quot;</span><span class="p">,</span> <span class="s2">&quot;http://google.com&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;https://google.com&quot;</span><span class="p">,</span> <span class="s2">&quot;http://www.google.com/doodles/&quot;</span><span class="p">,</span> <span class="s2">&quot;http://www.google.com /doodles/&quot;</span><span class="p">]</span>

<span class="c1"># Test if the URL is valid</span>
<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">test_url</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">tester</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">f</span><span class="s2">&quot;{text} is a Valid URL&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">f</span><span class="s2">&quot;{text} is not a Valid URL&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span> <span class="k">is</span> <span class="n">a</span> <span class="k">Valid</span> <span class="n">URL</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span> <span class="k">is</span> <span class="n">a</span> <span class="k">Valid</span> <span class="n">URL</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">google</span><span class="p">.</span><span class="n">com</span> <span class="k">is</span> <span class="n">a</span> <span class="k">Valid</span> <span class="n">URL</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">google</span><span class="p">.</span><span class="n">com</span> <span class="k">is</span> <span class="n">a</span> <span class="k">Valid</span> <span class="n">URL</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">doodles</span><span class="o">/</span> <span class="k">is</span> <span class="n">a</span> <span class="k">Valid</span> <span class="n">URL</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="p">.</span><span class="n">google</span><span class="p">.</span><span class="n">com</span> <span class="o">/</span><span class="n">doodles</span><span class="o">/</span> <span class="k">is</span> <span class="k">not</span> <span class="n">a</span> <span class="k">Valid</span> <span class="n">URL</span>
</pre></div>


<ul>
<li>To be honest, VerbalExpression is not completely well-built on Python. There are still some components missing. Remember that we have things like this in RegEx ?</li>
</ul>
<div class="highlight"><pre><span></span><span class="o">*</span> <span class="o">-</span> <span class="n">Zero</span> <span class="k">or</span> <span class="k">more</span>
<span class="o">+</span> <span class="o">-</span> <span class="n">One</span> <span class="k">or</span> <span class="k">more</span>
<span class="o">?</span> <span class="o">-</span> <span class="n">Zero</span> <span class="k">or</span> <span class="n">one</span>
<span class="err">{</span><span class="n">n</span><span class="err">}</span> <span class="o">-</span> <span class="n">Exactly</span> <span class="s1">&#39;n&#39;</span> <span class="nb">number</span>
<span class="err">{</span><span class="n">n</span><span class="p">,</span><span class="err">}</span> <span class="o">-</span> <span class="n">Matches</span> <span class="s1">&#39;n&#39;</span> <span class="k">or</span> <span class="k">more</span> <span class="n">occurrences</span>
<span class="err">{</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="err">}</span> <span class="o">-</span> <span class="k">Between</span> <span class="s1">&#39;n&#39;</span> <span class="k">and</span> <span class="s1">&#39;m&#39;</span>
</pre></div>


<ul>
<li>For now VerbalExpression does not have any function to support this syntax. Hence, in order for us to use this, we need to manually add in.</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">verbal_expression</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="err">{</span><span class="mi">0</span><span class="p">,</span><span class="err">}</span><span class="p">)</span>  <span class="c1">--&gt; * - Zero or more</span>
<span class="n">verbal_expression</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="err">{</span><span class="mi">1</span><span class="p">,</span><span class="err">}</span><span class="p">)</span>  <span class="c1">--&gt; + - One or more</span>
<span class="n">verbal_expression</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="err">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="err">}</span><span class="p">)</span> <span class="c1">--&gt; ? - Zero or one</span>
<span class="n">verbal_expression</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="err">{</span><span class="n">n</span><span class="err">}</span><span class="p">)</span>   <span class="c1">--&gt; {n} - Exactly &#39;n&#39; number</span>
<span class="n">verbal_expression</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="err">{</span><span class="n">n</span><span class="p">,</span><span class="err">}</span><span class="p">)</span>  <span class="c1">--&gt; {n,} - Matches &#39;n&#39; or more occurrences</span>
<span class="n">verbal_expression</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="err">{</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="err">}</span><span class="p">)</span> <span class="c1">--&gt; {n,m} - Between &#39;n&#39; and &#39;m&#39;</span>
</pre></div>


<ul>
<li>Let's find words consist of more than 2 "very" words</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">verbal_expression</span> <span class="o">=</span> <span class="n">VerEx</span><span class="p">()</span>
<span class="n">tester</span> <span class="o">=</span> <span class="p">(</span><span class="n">verbal_expression</span><span class="o">.</span>
            <span class="n">find</span><span class="p">(</span><span class="s2">&quot;very&quot;</span><span class="p">)</span><span class="o">.</span>
            <span class="n">add</span><span class="p">(</span><span class="s2">&quot;{2,}&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">tester</span><span class="o">.</span><span class="n">source</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">very</span><span class="p">)</span><span class="err">{</span><span class="mi">2</span><span class="p">,</span><span class="err">}</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">test_very</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;very&quot;</span><span class="p">,</span><span class="s2">&quot;veryvery&quot;</span><span class="p">,</span><span class="s2">&quot;veryveryvery&quot;</span><span class="p">]</span>

<span class="c1"># Test if the word is correct</span>
<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">test_very</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">tester</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">f</span><span class="s2">&quot;{text} is a correct word&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">f</span><span class="s2">&quot;{text} is not a correct word&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span> <span class="k">is</span> <span class="k">not</span> <span class="n">a</span> <span class="n">correct</span> <span class="n">word</span>
<span class="n">very</span> <span class="k">is</span> <span class="k">not</span> <span class="n">a</span> <span class="n">correct</span> <span class="n">word</span>
<span class="n">veryvery</span> <span class="k">is</span> <span class="n">a</span> <span class="n">correct</span> <span class="n">word</span>
<span class="n">veryveryvery</span> <span class="k">is</span> <span class="n">a</span> <span class="n">correct</span> <span class="n">word</span>
</pre></div>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://mtruongn93.github.io/blog/blog-3.html">posted at 10:20</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://mtruongn93.github.io/blog/tag/python.html" class="tags selected">python</a>
                </div>
            </article>            <h4 class="date">Jul 04, 2019</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://mtruongn93.github.io/blog/blog-2.html" rel="bookmark" title="Permanent Link to &quot;Pipeline&quot;">Pipeline</a>
                </h2>

                
                

                <p>In data science, one of the most tedious step that we need to perform is feature engineering and modeling. These steps are very repetitive. Luckily, creating a <strong>pipeline</strong> can help us solve this problem.</p>
<h1>What is a pipeline ?</h1>
<p>In a simple term, pipeline is a tool in sklearn package for us to compose multiple estimators. For example, when we want to analyse a dataset, we may need to choose the features (columns) that we want, standardize them and apply the model. All of these steps can be escapulated in a <code>Pipeline</code> </p>
<p>Assuming we have a dataset like the one below, and we want to predict which food a person wants to eat based on their gender, age, height, weight and an unknown feature "empty_col".</p>
<div class="highlight"><pre><span></span><span class="c1"># Importing library</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">gender</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;male&quot;</span><span class="p">,</span><span class="s2">&quot;female&quot;</span><span class="p">]</span>
<span class="n">food</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Viet&quot;</span><span class="p">,</span> <span class="s2">&quot;Thai&quot;</span><span class="p">,</span> <span class="s2">&quot;Chinese&quot;</span><span class="p">,</span> <span class="s2">&quot;Western&quot;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">data1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;gender&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">gender</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
                      <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span><span class="mi">20</span><span class="p">),</span>
                      <span class="s2">&quot;height&quot;</span> <span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">170</span><span class="p">),</span><span class="mi">20</span><span class="p">),</span>
                      <span class="s2">&quot;weight&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
                      <span class="s2">&quot;empty_col&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
                      <span class="s2">&quot;food&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">food</span><span class="p">,</span><span class="mi">20</span><span class="p">)})</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>height</th>
      <th>weight</th>
      <th>empty_col</th>
      <th>food</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>male</td>
      <td>58</td>
      <td>167</td>
      <td>213.127056</td>
      <td>None</td>
      <td>Western</td>
    </tr>
    <tr>
      <th>1</th>
      <td>male</td>
      <td>55</td>
      <td>151</td>
      <td>161.579091</td>
      <td>None</td>
      <td>Chinese</td>
    </tr>
    <tr>
      <th>2</th>
      <td>female</td>
      <td>40</td>
      <td>164</td>
      <td>227.105995</td>
      <td>None</td>
      <td>Chinese</td>
    </tr>
    <tr>
      <th>3</th>
      <td>female</td>
      <td>54</td>
      <td>155</td>
      <td>223.072513</td>
      <td>None</td>
      <td>Western</td>
    </tr>
    <tr>
      <th>4</th>
      <td>female</td>
      <td>33</td>
      <td>158</td>
      <td>248.173858</td>
      <td>None</td>
      <td>Viet</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">data1</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="k">class</span> <span class="s1">&#39;pandas.core.frame.DataFrame&#39;</span><span class="o">&gt;</span>
<span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">20</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="k">to</span> <span class="mi">19</span>
<span class="k">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">6</span> <span class="n">columns</span><span class="p">):</span>
<span class="n">gender</span>       <span class="mi">20</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="k">object</span>
<span class="n">age</span>          <span class="mi">20</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">height</span>       <span class="mi">20</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">weight</span>       <span class="mi">20</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">float64</span>
<span class="n">empty_col</span>    <span class="mi">0</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="k">object</span>
<span class="n">food</span>         <span class="mi">20</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="k">object</span>
<span class="n">dtypes</span><span class="p">:</span> <span class="n">float64</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">int64</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">object</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">memory</span> <span class="k">usage</span><span class="p">:</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="o">+</span> <span class="n">KB</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">data1</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;food&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">data1</span><span class="p">[</span><span class="s2">&quot;food&quot;</span><span class="p">]</span>
</pre></div>


<p>Let's say, for some reasons, the person analyzing this dataset only wants to use features <code>age, height, weight, and empty_col</code> to predict the food.</p>
<div class="highlight"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;gender&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>height</th>
      <th>weight</th>
      <th>empty_col</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>58</td>
      <td>167</td>
      <td>213.127056</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>55</td>
      <td>151</td>
      <td>161.579091</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>40</td>
      <td>164</td>
      <td>227.105995</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>54</td>
      <td>155</td>
      <td>223.072513</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>33</td>
      <td>158</td>
      <td>248.173858</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>56</td>
      <td>150</td>
      <td>236.798867</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>32</td>
      <td>153</td>
      <td>170.120662</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>42</td>
      <td>163</td>
      <td>196.733247</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>36</td>
      <td>159</td>
      <td>231.915150</td>
      <td>None</td>
    </tr>
    <tr>
      <th>9</th>
      <td>22</td>
      <td>162</td>
      <td>190.901033</td>
      <td>None</td>
    </tr>
    <tr>
      <th>10</th>
      <td>45</td>
      <td>154</td>
      <td>192.580001</td>
      <td>None</td>
    </tr>
    <tr>
      <th>11</th>
      <td>21</td>
      <td>157</td>
      <td>215.189645</td>
      <td>None</td>
    </tr>
    <tr>
      <th>12</th>
      <td>43</td>
      <td>165</td>
      <td>225.999820</td>
      <td>None</td>
    </tr>
    <tr>
      <th>13</th>
      <td>24</td>
      <td>152</td>
      <td>160.628936</td>
      <td>None</td>
    </tr>
    <tr>
      <th>14</th>
      <td>51</td>
      <td>166</td>
      <td>195.947550</td>
      <td>None</td>
    </tr>
    <tr>
      <th>15</th>
      <td>48</td>
      <td>161</td>
      <td>177.813970</td>
      <td>None</td>
    </tr>
    <tr>
      <th>16</th>
      <td>34</td>
      <td>169</td>
      <td>231.051503</td>
      <td>None</td>
    </tr>
    <tr>
      <th>17</th>
      <td>49</td>
      <td>160</td>
      <td>235.308763</td>
      <td>None</td>
    </tr>
    <tr>
      <th>18</th>
      <td>25</td>
      <td>168</td>
      <td>196.450121</td>
      <td>None</td>
    </tr>
    <tr>
      <th>19</th>
      <td>37</td>
      <td>156</td>
      <td>231.366207</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<p>The method shown above is one way to do it. However, imagine that we need to do it for so many datasets, it will become extremely tedious. In addition, when our datasets are getting more complicated, doing that way repetitively will make our code become hard to read. We are going to create a class that can automate that process, and can be put in a pipeline</p>
<h1>Custom Transformers</h1>
<p>There are multiple written Transformers in Python such as StandardScaler, and LabelBinarizer. However, during our feature engineering, we usually need to write our own transformers. Here is the general template for a custom transformers:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTransformer</span><span class="p">(</span><span class="n">TransformerMixin</span><span class="p">,</span> <span class="n">BaseEstimator</span><span class="p">):</span>

     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

     <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

     <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="c1"># transform code</span>
         <span class="k">return</span> <span class="n">X</span>
</pre></div>


<ul>
<li><code>TransformerMixin</code> gives us the access to the extremely popular and useful <code>.fit_transform</code> method.</li>
<li><code>BaseEstimator</code> will be very beneficial when we use <code>GridSearch</code> function in the future as it helps us the the access to <code>.get_params</code></li>
<li><code>__init__</code> is there so that we can intialize the transformer by just typing <code>MyTransformer()</code></li>
<li><code>fit</code> will return self. We can see that even though we are not going to transform y, we still need to include it as a parameter and set it to None. This is because in case we want to include a model in a pipeline, a fit in those model will require a <code>y</code></li>
<li><code>transform</code>: this is where all the magic happens, and our transformed X will be produced from here.</li>
</ul>
<p>We are going to create our own transformers to choose the columns that we want</p>
<div class="highlight"><pre><span></span><span class="c1"># The code based on https://ramhiser.com/post/2018-04-16-building-scikit-learn-pipeline-with-pandas-dataframe/</span>

<span class="k">class</span> <span class="nc">ColumnSelector</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">cols_error</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;The DataFrame does not include the columns: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cols_error</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">cs</span> <span class="o">=</span> <span class="n">ColumnSelector</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="s2">&quot;empty_col&quot;</span><span class="p">])</span>
<span class="n">cs</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>height</th>
      <th>weight</th>
      <th>empty_col</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>58</td>
      <td>167</td>
      <td>213.127056</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>55</td>
      <td>151</td>
      <td>161.579091</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>40</td>
      <td>164</td>
      <td>227.105995</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>54</td>
      <td>155</td>
      <td>223.072513</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>33</td>
      <td>158</td>
      <td>248.173858</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let's create another transformer which removes the columns with &gt; 50% missing</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NotManyNaColumns</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="n">na_col</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">too_many_na_col</span> <span class="o">=</span> <span class="n">na_col</span><span class="p">[</span><span class="n">na_col</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span>
        <span class="k">return</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">too_many_na_col</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">na_col</span> <span class="o">=</span> <span class="n">NotManyNaColumns</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">na_col</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>height</th>
      <th>weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>male</td>
      <td>58</td>
      <td>167</td>
      <td>213.127056</td>
    </tr>
    <tr>
      <th>1</th>
      <td>male</td>
      <td>55</td>
      <td>151</td>
      <td>161.579091</td>
    </tr>
    <tr>
      <th>2</th>
      <td>female</td>
      <td>40</td>
      <td>164</td>
      <td>227.105995</td>
    </tr>
    <tr>
      <th>3</th>
      <td>female</td>
      <td>54</td>
      <td>155</td>
      <td>223.072513</td>
    </tr>
    <tr>
      <th>4</th>
      <td>female</td>
      <td>33</td>
      <td>158</td>
      <td>248.173858</td>
    </tr>
  </tbody>
</table>
</div>

<p>As we can see, <code>empty_col</code> column has been removed since it has more than 50% missing values. However, if we use this function, we can't perform a similar transformation on the training data to a test data. Let's take a look at an example.</p>
<div class="highlight"><pre><span></span><span class="n">data2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;gender&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">gender</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
                      <span class="s2">&quot;age&quot;</span> <span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span><span class="mi">20</span><span class="p">),</span>
                      <span class="s2">&quot;height&quot;</span> <span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">170</span><span class="p">),</span><span class="mi">20</span><span class="p">),</span>
                      <span class="s2">&quot;weight&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
                      <span class="s2">&quot;empty_col&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
                      <span class="s2">&quot;food&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">food</span><span class="p">,</span><span class="mi">20</span><span class="p">)})</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X_test</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;food&quot;</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">data2</span><span class="p">[</span><span class="s2">&quot;food&quot;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X_test</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="k">class</span> <span class="s1">&#39;pandas.core.frame.DataFrame&#39;</span><span class="o">&gt;</span>
<span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">20</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="k">to</span> <span class="mi">19</span>
<span class="k">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">5</span> <span class="n">columns</span><span class="p">):</span>
<span class="n">gender</span>       <span class="mi">20</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="k">object</span>
<span class="n">age</span>          <span class="mi">20</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">height</span>       <span class="mi">20</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int64</span>
<span class="n">weight</span>       <span class="mi">20</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">float64</span>
<span class="n">empty_col</span>    <span class="mi">20</span> <span class="n">non</span><span class="o">-</span><span class="k">null</span> <span class="n">int32</span>
<span class="n">dtypes</span><span class="p">:</span> <span class="n">float64</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">int32</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">int64</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="k">object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">memory</span> <span class="k">usage</span><span class="p">:</span> <span class="mi">800</span><span class="p">.</span><span class="mi">0</span><span class="o">+</span> <span class="n">bytes</span>
</pre></div>


<p>This dataset surely has no column having more than 50% missing value. However, we need to make our training and testing dataset to have the same column. If we use the <code>NotManyNaColumns</code> as shown above, we will not get it.</p>
<div class="highlight"><pre><span></span><span class="n">na_col</span> <span class="o">=</span> <span class="n">NotManyNaColumns</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">na_col</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>height</th>
      <th>weight</th>
      <th>empty_col</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>female</td>
      <td>25</td>
      <td>166</td>
      <td>236.519943</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>female</td>
      <td>45</td>
      <td>150</td>
      <td>173.783799</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>male</td>
      <td>35</td>
      <td>167</td>
      <td>198.093367</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>male</td>
      <td>47</td>
      <td>163</td>
      <td>240.642942</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>female</td>
      <td>42</td>
      <td>151</td>
      <td>173.177008</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let's write a new code to get what we want</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NotManyNaColumns</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">TransformerMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">na_col</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">too_many_na_col</span> <span class="o">=</span> <span class="n">na_col</span><span class="p">[</span><span class="n">na_col</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">too_many_na_col</span> <span class="o">=</span> <span class="n">too_many_na_col</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">too_many_na_col</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>What we did in here is to make sure whatever we did in the training set, will be performed on the testing set. We are going to fit and transform on the training dataset, but only transform on the testing set.</p>
<div class="highlight"><pre><span></span><span class="n">na_col</span> <span class="o">=</span> <span class="n">NotManyNaColumns</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">na_col</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>height</th>
      <th>weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>male</td>
      <td>58</td>
      <td>167</td>
      <td>213.127056</td>
    </tr>
    <tr>
      <th>1</th>
      <td>male</td>
      <td>55</td>
      <td>151</td>
      <td>161.579091</td>
    </tr>
    <tr>
      <th>2</th>
      <td>female</td>
      <td>40</td>
      <td>164</td>
      <td>227.105995</td>
    </tr>
    <tr>
      <th>3</th>
      <td>female</td>
      <td>54</td>
      <td>155</td>
      <td>223.072513</td>
    </tr>
    <tr>
      <th>4</th>
      <td>female</td>
      <td>33</td>
      <td>158</td>
      <td>248.173858</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">na_col</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>age</th>
      <th>height</th>
      <th>weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>female</td>
      <td>25</td>
      <td>166</td>
      <td>236.519943</td>
    </tr>
    <tr>
      <th>1</th>
      <td>female</td>
      <td>45</td>
      <td>150</td>
      <td>173.783799</td>
    </tr>
    <tr>
      <th>2</th>
      <td>male</td>
      <td>35</td>
      <td>167</td>
      <td>198.093367</td>
    </tr>
    <tr>
      <th>3</th>
      <td>male</td>
      <td>47</td>
      <td>163</td>
      <td>240.642942</td>
    </tr>
    <tr>
      <th>4</th>
      <td>female</td>
      <td>42</td>
      <td>151</td>
      <td>173.177008</td>
    </tr>
  </tbody>
</table>
</div>

<p>As we can see, our training data and testing data have the same columns, even though the <code>empty_col</code> column in the testing data does not have more than 50% missing value.</p>
<h1>Pipeline</h1>
<p>Finally, we are going to learn about Pipeline !!! Normally, we are going to analyse our data using this way</p>
<div class="highlight"><pre><span></span><span class="c1"># Select Column</span>
<span class="n">cs</span> <span class="o">=</span> <span class="n">ColumnSelector</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="s2">&quot;empty_col&quot;</span><span class="p">])</span>
<span class="n">X_train_transformed</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="c1"># Select good columns</span>
<span class="n">na_col</span> <span class="o">=</span> <span class="n">NotManyNaColumns</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">X_train_transformed</span> <span class="o">=</span> <span class="n">na_col</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_transformed</span><span class="p">)</span>

<span class="c1"># Standard Scaler</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_train_transformed</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train_transformed</span><span class="p">)</span>

<span class="c1"># Apply Logistic Regression to predict the food</span>
<span class="n">lg</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;lbfgs&quot;</span><span class="p">)</span>
<span class="n">lg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_transformed</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">lg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_transformed</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nb">array</span><span class="p">([</span><span class="s1">&#39;Western&#39;</span><span class="p">,</span> <span class="s1">&#39;Thai&#39;</span><span class="p">,</span> <span class="s1">&#39;Western&#39;</span><span class="p">,</span> <span class="s1">&#39;Thai&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span> <span class="s1">&#39;Thai&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Chinese&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span> <span class="s1">&#39;Western&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Chinese&#39;</span><span class="p">,</span> <span class="s1">&#39;Chinese&#39;</span><span class="p">,</span> <span class="s1">&#39;Western&#39;</span><span class="p">,</span> <span class="s1">&#39;Thai&#39;</span><span class="p">,</span> <span class="s1">&#39;Chinese&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="k">object</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Check the score</span>
<span class="n">lg</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train_transformed</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="mi">0</span><span class="p">.</span><span class="mi">45</span>
</pre></div>


<p>There are so many steps that we need to do as shown above. We can make things shorter by using <code>make_pipeline</code>.</p>
<div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">ColumnSelector</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span><span class="s2">&quot;empty_col&quot;</span><span class="p">]),</span>
                     <span class="n">NotManyNaColumns</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span>
                     <span class="n">StandardScaler</span><span class="p">(),</span>
                     <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span> <span class="o">=</span> <span class="s2">&quot;lbfgs&quot;</span><span class="p">))</span>
</pre></div>


<p><strong>Note : Order is important</strong></p>
<div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Pipeline</span><span class="p">(</span><span class="n">memory</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
     <span class="n">steps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;columnselector&#39;</span><span class="p">,</span> <span class="n">ColumnSelector</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;empty_col&#39;</span><span class="p">])),</span> <span class="p">(</span><span class="s1">&#39;notmanynacolumns&#39;</span><span class="p">,</span> <span class="n">NotManyNaColumns</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;standardscaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="k">copy</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">with_mean</span><span class="o">=</span><span class="k">True</span><span class="p">,</span> <span class="n">with_std</span><span class="o">=</span><span class="k">True</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;logisticregression&#39;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="k">C</span><span class="o">=</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">class_weight</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">dual</span><span class="o">=</span><span class="n">F</span><span class="p">...</span><span class="n">enalty</span><span class="o">=</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span>
          <span class="n">tol</span><span class="o">=</span><span class="mi">0</span><span class="p">.</span><span class="mi">0001</span><span class="p">,</span> <span class="k">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="k">False</span><span class="p">))])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nb">array</span><span class="p">([</span><span class="s1">&#39;Western&#39;</span><span class="p">,</span> <span class="s1">&#39;Thai&#39;</span><span class="p">,</span> <span class="s1">&#39;Western&#39;</span><span class="p">,</span> <span class="s1">&#39;Thai&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span> <span class="s1">&#39;Thai&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Chinese&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span> <span class="s1">&#39;Western&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">,</span>
       <span class="s1">&#39;Chinese&#39;</span><span class="p">,</span> <span class="s1">&#39;Chinese&#39;</span><span class="p">,</span> <span class="s1">&#39;Western&#39;</span><span class="p">,</span> <span class="s1">&#39;Thai&#39;</span><span class="p">,</span> <span class="s1">&#39;Chinese&#39;</span><span class="p">,</span> <span class="s1">&#39;Viet&#39;</span><span class="p">],</span>
      <span class="n">dtype</span><span class="o">=</span><span class="k">object</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="mi">0</span><span class="p">.</span><span class="mi">45</span>
</pre></div>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://mtruongn93.github.io/blog/blog-2.html">posted at 10:20</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://mtruongn93.github.io/blog/tag/python.html" class="tags selected">python</a>
                </div>
            </article>            <h4 class="date">Jun 16, 2019</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://mtruongn93.github.io/blog/blog-1.html" rel="bookmark" title="Permanent Link to &quot;List Comprehension&quot;">List Comprehension</a>
                </h2>

                
                

                <p>If you are a new Python user, or a loop addicted user, it's time for you to consider to change to something new, something that makes your code run faster, and look much better.</p>
<p>Introducing <strong>List Comprehension</strong></p>
<h2>What is List Comprehension ?</h2>
<p>List comprehension is just a succint and elegant way for people to create a new list where every element in the list is created based on a certain rule</p>
<p>Let's take a look at an example. </p>
<p>Imagine we are having a list of numbers, and we are trying to create a new list, containing the square root of every elemnet in the existing loop. Normally, a lot of programmer will do like this :</p>
<div class="highlight"><pre><span></span><span class="n">existing_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">49</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">81</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>

<span class="c1"># Create an empty list</span>
<span class="n">sqrt_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Make a for loop and apply the square root to each element in the existing_list</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">existing_list</span><span class="p">:</span>
    <span class="c1"># append the newly calculated elements to the empty list</span>
    <span class="n">sqrt_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">sqrt_list</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<p>Obviously, there is nothing wrong with doing this way. However, list comprehension can greatly reduce the length of the code above.</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="n">i</span><span class="o">**</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">existing_list</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<h2>Why is List Comprehension better than traditonal Loop ?</h2>
<p><code>Good programmers write code that humans can understand. 
                                           Martin Fowler</code></p>
<p>List comprehension clearly makes our code much more readable and shorter than traditional loop. As we can see from the code above, it reduces 3 lines of code into 1. Anyone with a basic understanding of list comprehension can easily understand it.</p>
<p>In addition, list comprehension is also faster than traditional loop. One of the reason is that it doesn't need to load the append attribute of the list and call it as a function at each iteration</p>
<h2>How do we write a list comprehension ?</h2>
<p>I used to know a lot of people having hard time with using list comprehension as they are too comfortable with using traditonal loop; and hence, less willing to change.</p>
<p>To be honest, creating a list comprehension is even easier than making a traditional loop as you do not even need to use .append.</p>
<p>Normally, the format of a list comprehension will be : <code>[expression for item in list]</code></p>
<p><code>Expression</code> is just the method that you want to transform each element of your list</p>
<p><code>item</code> is each element in your list</p>
<h2>Type of List Comprehension</h2>
<h3>1. Unconditional List Comprehension</h3>
<p>We have a list of name, and we want to captitalize all the letters of every name in the list</p>
<div class="highlight"><pre><span></span><span class="n">string_name</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;minh&quot;</span><span class="p">,</span> <span class="s2">&quot;megan&quot;</span><span class="p">,</span> <span class="s2">&quot;cody&quot;</span><span class="p">,</span> <span class="s2">&quot;blair&quot;</span><span class="p">,</span> <span class="s2">&quot;lucas&quot;</span><span class="p">,</span> <span class="s2">&quot;sarah&quot;</span><span class="p">,</span> <span class="s2">&quot;vishal&quot;</span><span class="p">]</span>

<span class="c1"># traditional loop</span>
<span class="n">capital_name</span> <span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">string_name</span><span class="p">:</span>
    <span class="n">capital_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

<span class="n">capital_name</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;MAX&#39;</span><span class="p">,</span> <span class="s1">&#39;MINH&#39;</span><span class="p">,</span> <span class="s1">&#39;MEGAN&#39;</span><span class="p">,</span> <span class="s1">&#39;CODY&#39;</span><span class="p">,</span> <span class="s1">&#39;BLAIR&#39;</span><span class="p">,</span> <span class="s1">&#39;LUCAS&#39;</span><span class="p">,</span> <span class="s1">&#39;SARAH&#39;</span><span class="p">,</span> <span class="s1">&#39;VISHAL&#39;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># list comprehension</span>
<span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">string_name</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;MAX&#39;</span><span class="p">,</span> <span class="s1">&#39;MINH&#39;</span><span class="p">,</span> <span class="s1">&#39;MEGAN&#39;</span><span class="p">,</span> <span class="s1">&#39;CODY&#39;</span><span class="p">,</span> <span class="s1">&#39;BLAIR&#39;</span><span class="p">,</span> <span class="s1">&#39;LUCAS&#39;</span><span class="p">,</span> <span class="s1">&#39;SARAH&#39;</span><span class="p">,</span> <span class="s1">&#39;VISHAL&#39;</span><span class="p">]</span>
</pre></div>


<h3>2. Conditional List Comprehension</h3>
<p>Assuming we have a string like this: "hello everyone". We want to have a list of unique non-vowel letters in this string</p>
<div class="highlight"><pre><span></span><span class="n">string_hello</span> <span class="o">=</span> <span class="s2">&quot;hello everyone&quot;</span>
<span class="n">vowels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;e&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">,</span><span class="s2">&quot;u&quot;</span><span class="p">]</span>

<span class="c1"># traditional loop</span>
<span class="n">non_vowel_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">string_hello</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vowels</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">non_vowel_list</span><span class="p">:</span> 
        <span class="n">non_vowel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="n">non_vowel_list</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c1"># list comprehension</span>
<span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">string_hello</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">vowels</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nb">array</span><span class="p">([</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;U1&#39;</span><span class="p">)</span>
</pre></div>


<p>Let's look at a more complicated case with an if-else statement. </p>
<div class="highlight"><pre><span></span><span class="c1"># if the number in the list is the multiple of 3, we change in to 3, else double it</span>

<span class="n">num_string</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span>

<span class="c1"># traditional loop</span>
<span class="n">num_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_string</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">num_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">num_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

<span class="n">num_list</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># list comprehension</span>
<span class="p">[</span><span class="mi">3</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">i</span><span class="o">*</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">num_string</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</pre></div>


<h3>3. Nested List Comprehension</h3>
<p>Now, since we are a bit better at list comprehension, we are going to do a more advanced stuff : list comprehension with nested loop.</p>
<div class="highlight"><pre><span></span><span class="c1"># return a list of string with length &gt; 10</span>

<span class="n">club_string</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Manchester United&quot;</span><span class="p">,</span> <span class="s2">&quot;Liverpool&quot;</span><span class="p">,</span> <span class="s2">&quot;Chelsea&quot;</span><span class="p">],</span>
               <span class="p">[</span><span class="s2">&quot;Real Marid&quot;</span><span class="p">,</span> <span class="s2">&quot;Barcelona&quot;</span><span class="p">,</span> <span class="s2">&quot;Valencia&quot;</span><span class="p">]]</span>

<span class="n">club_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># traditional loop</span>
<span class="k">for</span> <span class="n">leauge</span> <span class="ow">in</span> <span class="n">club_string</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">club</span> <span class="ow">in</span> <span class="n">leauge</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">club</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">club_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">club</span><span class="p">)</span>

<span class="n">club_list</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;Manchester United&#39;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># list comprehension</span>
<span class="p">[</span><span class="n">club</span> 
 <span class="k">for</span> <span class="n">leauge</span> <span class="ow">in</span> <span class="n">club_string</span> 
 <span class="k">for</span> <span class="n">club</span> <span class="ow">in</span> <span class="n">leauge</span>
 <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">club</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;Manchester United&#39;</span><span class="p">]</span>
</pre></div>


<p><strong>DO NOT OVERUSE LIST COMPREHENSION</strong></p>
<p>One of the purpose of writing list comprehension is better readability. Cramping everything inside the list comprehension will make thing even worse than traditional loop. For example:</p>
<div class="highlight"><pre><span></span><span class="c1"># return a list of number staying within a list of number with length of less than 3 and multiple this</span>
<span class="c1"># number by 2 if it is odd or by 3 if it is even</span>

<span class="n">number_list</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">]]</span>

<span class="p">[</span><span class="n">number</span><span class="o">*</span><span class="mi">2</span> <span class="k">if</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">number</span><span class="o">*</span><span class="mi">3</span> <span class="k">for</span> <span class="n">list_</span> <span class="ow">in</span> <span class="n">number_list</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">list_</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
</pre></div>


<p>The first way that we can fix it is to break the line</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="n">number</span><span class="o">*</span><span class="mi">2</span> 
 <span class="k">if</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> 
 <span class="k">else</span> <span class="n">number</span><span class="o">*</span><span class="mi">3</span> 
 <span class="k">for</span> <span class="n">list_</span> <span class="ow">in</span> <span class="n">number_list</span> 
 <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> 
 <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">list_</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
</pre></div>


<p>Another way to make the code look easier is to create an extra function</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">num_condition</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">*</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">*</span><span class="mi">3</span>

<span class="p">[</span><span class="n">num_condition</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="k">for</span> <span class="n">list_</span> <span class="ow">in</span> <span class="n">number_list</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">list_</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
</pre></div>


<h2>Dictionary Comprehension</h2>
<p>Knowing how to write a list comprehension is smiliar to "buy 1 get 1" as you will be able to write a dictionary comprehension.</p>
<p>Similar to list comprehension, dictionary comprehension is a concise, and fast way to produce a new dictionary where every key and value are based on a certain rule.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">city_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;city&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Toronto&quot;</span><span class="p">,</span><span class="s2">&quot;Waterloo&quot;</span><span class="p">,</span> <span class="s2">&quot;Toronto&quot;</span><span class="p">,</span> <span class="s2">&quot;Vancouver&quot;</span><span class="p">,</span> <span class="s2">&quot;Waterloo&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;house_price&quot;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1000000</span><span class="p">,</span><span class="mi">500000</span><span class="p">,</span><span class="mi">700000</span><span class="p">,</span><span class="mi">800000</span><span class="p">,</span><span class="mi">600000</span><span class="p">]})</span>
<span class="n">city_df</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city</th>
      <th>house_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Toronto</td>
      <td>1000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Waterloo</td>
      <td>500000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Toronto</td>
      <td>700000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Vancouver</td>
      <td>800000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Waterloo</td>
      <td>600000</td>
    </tr>
  </tbody>
</table>
</div>

<p>For example, we have a dataframe as shown above, and we want to get a dictionary showing the average house price of each city. The way to write a dictionary comprehension is really similar to write a list comprehension. The only difference is that we need to have values and keys for the output</p>
<div class="highlight"><pre><span></span><span class="n">city</span> <span class="o">=</span> <span class="n">city_df</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">{</span><span class="n">i</span> <span class="p">:</span> <span class="p">(</span><span class="n">city_df</span><span class="o">.</span><span class="n">house_price</span><span class="p">[</span><span class="n">city_df</span><span class="o">.</span><span class="n">city</span> <span class="o">==</span> <span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">city</span><span class="p">}</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">{</span><span class="s1">&#39;Toronto&#39;</span><span class="p">:</span> <span class="mi">850000</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Waterloo&#39;</span><span class="p">:</span> <span class="mi">550000</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Vancouver&#39;</span><span class="p">:</span> <span class="mi">800000</span><span class="p">.</span><span class="mi">0</span><span class="err">}</span>
</pre></div>
                <div class="clear"></div>

                <div class="info">
                    <a href="https://mtruongn93.github.io/blog/blog-1.html">posted at 10:20</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://mtruongn93.github.io/blog/tag/python.html" class="tags selected">python</a>
                </div>
            </article>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="https://mtruongn93.github.io/blog/feeds/all.atom.xml" rel="alternate">Atom Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>