<!DOCTYPE html>
<html lang="en">
<head>
 <title>Third Blog</title>
 <!-- Latest compiled and minified CSS -->
 <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
 <div class="container">
  <h1><a href="https://mtruongn93.github.io/blog">Truong</a></h1>
 </div>
</head>
<body>
 <div class="container">
<div class="row">
 <div class="col-md-8">
  <h3>Third Blog</h3>
  <label>2011-03-29</label>
  <p><img src="http://imgur.com/1ZcRyrc.png" style="float: left; margin: 20px; height: 55px"></p>
<h1>Train-Test Split and Cross-Validation Lab</h1>
<hr>
<h2>Review of Train/Test Validation Methods</h2>
<p>We've discussed overfitting, underfitting, and how to validate the "generalizeability" of your models by testing them on unseen data. </p>
<p>In this lab you'll practice two related validation methods: 
1. <strong>train/test split</strong>
2. <strong>k-fold cross-validation</strong></p>
<p>Train/test split and k-fold cross-validation both serve two useful purposes:
- We prevent overfitting by not using all the data, and
- We retain some remaining data to evaluate our model.</p>
<p>In the case of cross-validation, the model fitting and evaluation is performed multiple times on different train/test splits of the data.</p>
<p>Ultimately we can use the train/test validation framework to compare multiple models on the same dataset. This could be comparisons of two linear models, or of completely different models on the same data.</p>
<h2>Instructions</h2>
<p>For your lab, fit <strong>three different models</strong> on the Boston Housing Data. For example, you could pick three different subsets of variables, one or more polynomial models, or any other model that you like. </p>
<p><strong>Start with train/test split validation:</strong>
* Fix a testing/training split of the data.
* Train each of your models on the training data.
* Evaluate each of the models on the testing data.
* Rank the models by how well they score on the testing data set.</p>
<p><strong>Then try k-fold cross-validation:</strong>
* Perform a k-fold cross-validation and use the cross-validation scores to compare your models. Did this change your rankings?
* Try a few different k-splits of the data for the same models.</p>
<p>If you're interested, try a variety of response variables. We start with <strong>MEDV</strong> (the <code>.target</code> attribute from the data set load method).</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">KFold</span><span class="p">,</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">figure_format</span> <span class="o">=</span> <span class="s1">&#39;retina&#39;</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;fivethirtyeight&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_boston</span>
<span class="n">boston</span> <span class="o">=</span> <span class="n">load_boston</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">boston</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">boston</span><span class="o">.</span><span class="n">feature_names</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">boston</span><span class="o">.</span><span class="n">target</span>
</pre></div>


<h3>1) Clean up any data problems.</h3>
<p>Fix any problems with the data, if applicable.</p>
<div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CRIM</th>
      <th>ZN</th>
      <th>INDUS</th>
      <th>CHAS</th>
      <th>NOX</th>
      <th>RM</th>
      <th>AGE</th>
      <th>DIS</th>
      <th>RAD</th>
      <th>TAX</th>
      <th>PTRATIO</th>
      <th>B</th>
      <th>LSTAT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.00632</td>
      <td>18.0</td>
      <td>2.31</td>
      <td>0.0</td>
      <td>0.538</td>
      <td>6.575</td>
      <td>65.2</td>
      <td>4.0900</td>
      <td>1.0</td>
      <td>296.0</td>
      <td>15.3</td>
      <td>396.90</td>
      <td>4.98</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.02731</td>
      <td>0.0</td>
      <td>7.07</td>
      <td>0.0</td>
      <td>0.469</td>
      <td>6.421</td>
      <td>78.9</td>
      <td>4.9671</td>
      <td>2.0</td>
      <td>242.0</td>
      <td>17.8</td>
      <td>396.90</td>
      <td>9.14</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.02729</td>
      <td>0.0</td>
      <td>7.07</td>
      <td>0.0</td>
      <td>0.469</td>
      <td>7.185</td>
      <td>61.1</td>
      <td>4.9671</td>
      <td>2.0</td>
      <td>242.0</td>
      <td>17.8</td>
      <td>392.83</td>
      <td>4.03</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.03237</td>
      <td>0.0</td>
      <td>2.18</td>
      <td>0.0</td>
      <td>0.458</td>
      <td>6.998</td>
      <td>45.8</td>
      <td>6.0622</td>
      <td>3.0</td>
      <td>222.0</td>
      <td>18.7</td>
      <td>394.63</td>
      <td>2.94</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.06905</td>
      <td>0.0</td>
      <td>2.18</td>
      <td>0.0</td>
      <td>0.458</td>
      <td>7.147</td>
      <td>54.2</td>
      <td>6.0622</td>
      <td>3.0</td>
      <td>222.0</td>
      <td>18.7</td>
      <td>396.90</td>
      <td>5.33</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CRIM</th>
      <th>ZN</th>
      <th>INDUS</th>
      <th>CHAS</th>
      <th>NOX</th>
      <th>RM</th>
      <th>AGE</th>
      <th>DIS</th>
      <th>RAD</th>
      <th>TAX</th>
      <th>PTRATIO</th>
      <th>B</th>
      <th>LSTAT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
      <td>506.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>3.613524</td>
      <td>11.363636</td>
      <td>11.136779</td>
      <td>0.069170</td>
      <td>0.554695</td>
      <td>6.284634</td>
      <td>68.574901</td>
      <td>3.795043</td>
      <td>9.549407</td>
      <td>408.237154</td>
      <td>18.455534</td>
      <td>356.674032</td>
      <td>12.653063</td>
    </tr>
    <tr>
      <th>std</th>
      <td>8.601545</td>
      <td>23.322453</td>
      <td>6.860353</td>
      <td>0.253994</td>
      <td>0.115878</td>
      <td>0.702617</td>
      <td>28.148861</td>
      <td>2.105710</td>
      <td>8.707259</td>
      <td>168.537116</td>
      <td>2.164946</td>
      <td>91.294864</td>
      <td>7.141062</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.006320</td>
      <td>0.000000</td>
      <td>0.460000</td>
      <td>0.000000</td>
      <td>0.385000</td>
      <td>3.561000</td>
      <td>2.900000</td>
      <td>1.129600</td>
      <td>1.000000</td>
      <td>187.000000</td>
      <td>12.600000</td>
      <td>0.320000</td>
      <td>1.730000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.082045</td>
      <td>0.000000</td>
      <td>5.190000</td>
      <td>0.000000</td>
      <td>0.449000</td>
      <td>5.885500</td>
      <td>45.025000</td>
      <td>2.100175</td>
      <td>4.000000</td>
      <td>279.000000</td>
      <td>17.400000</td>
      <td>375.377500</td>
      <td>6.950000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.256510</td>
      <td>0.000000</td>
      <td>9.690000</td>
      <td>0.000000</td>
      <td>0.538000</td>
      <td>6.208500</td>
      <td>77.500000</td>
      <td>3.207450</td>
      <td>5.000000</td>
      <td>330.000000</td>
      <td>19.050000</td>
      <td>391.440000</td>
      <td>11.360000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>3.677083</td>
      <td>12.500000</td>
      <td>18.100000</td>
      <td>0.000000</td>
      <td>0.624000</td>
      <td>6.623500</td>
      <td>94.075000</td>
      <td>5.188425</td>
      <td>24.000000</td>
      <td>666.000000</td>
      <td>20.200000</td>
      <td>396.225000</td>
      <td>16.955000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>88.976200</td>
      <td>100.000000</td>
      <td>27.740000</td>
      <td>1.000000</td>
      <td>0.871000</td>
      <td>8.780000</td>
      <td>100.000000</td>
      <td>12.126500</td>
      <td>24.000000</td>
      <td>711.000000</td>
      <td>22.000000</td>
      <td>396.900000</td>
      <td>37.970000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="c1"># category</span>
<span class="n">X</span><span class="o">.</span><span class="n">CHAS</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nb">array</span><span class="p">([</span><span class="mi">0</span><span class="p">.,</span> <span class="mi">1</span><span class="p">.])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">B</span> <span class="o">==</span> <span class="mf">0.32</span><span class="p">]</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CRIM</th>
      <th>ZN</th>
      <th>INDUS</th>
      <th>CHAS</th>
      <th>NOX</th>
      <th>RM</th>
      <th>AGE</th>
      <th>DIS</th>
      <th>RAD</th>
      <th>TAX</th>
      <th>PTRATIO</th>
      <th>B</th>
      <th>LSTAT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>450</th>
      <td>6.71772</td>
      <td>0.0</td>
      <td>18.1</td>
      <td>0.0</td>
      <td>0.713</td>
      <td>6.749</td>
      <td>92.6</td>
      <td>2.3236</td>
      <td>24.0</td>
      <td>666.0</td>
      <td>20.2</td>
      <td>0.32</td>
      <td>17.44</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CRIM</th>
      <th>ZN</th>
      <th>INDUS</th>
      <th>CHAS</th>
      <th>NOX</th>
      <th>RM</th>
      <th>AGE</th>
      <th>DIS</th>
      <th>RAD</th>
      <th>TAX</th>
      <th>PTRATIO</th>
      <th>B</th>
      <th>LSTAT</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>450</th>
      <td>6.71772</td>
      <td>0.0</td>
      <td>18.1</td>
      <td>0.0</td>
      <td>0.713</td>
      <td>6.749</td>
      <td>92.6</td>
      <td>2.3236</td>
      <td>24.0</td>
      <td>666.0</td>
      <td>20.2</td>
      <td>0.32</td>
      <td>17.44</td>
    </tr>
    <tr>
      <th>423</th>
      <td>7.05042</td>
      <td>0.0</td>
      <td>18.1</td>
      <td>0.0</td>
      <td>0.614</td>
      <td>6.103</td>
      <td>85.1</td>
      <td>2.0218</td>
      <td>24.0</td>
      <td>666.0</td>
      <td>20.2</td>
      <td>2.52</td>
      <td>23.29</td>
    </tr>
    <tr>
      <th>410</th>
      <td>51.13580</td>
      <td>0.0</td>
      <td>18.1</td>
      <td>0.0</td>
      <td>0.597</td>
      <td>5.757</td>
      <td>100.0</td>
      <td>1.4130</td>
      <td>24.0</td>
      <td>666.0</td>
      <td>20.2</td>
      <td>2.60</td>
      <td>10.11</td>
    </tr>
    <tr>
      <th>457</th>
      <td>8.20058</td>
      <td>0.0</td>
      <td>18.1</td>
      <td>0.0</td>
      <td>0.713</td>
      <td>5.936</td>
      <td>80.3</td>
      <td>2.7792</td>
      <td>24.0</td>
      <td>666.0</td>
      <td>20.2</td>
      <td>3.50</td>
      <td>16.94</td>
    </tr>
    <tr>
      <th>424</th>
      <td>8.79212</td>
      <td>0.0</td>
      <td>18.1</td>
      <td>0.0</td>
      <td>0.584</td>
      <td>5.565</td>
      <td>70.6</td>
      <td>2.0635</td>
      <td>24.0</td>
      <td>666.0</td>
      <td>20.2</td>
      <td>3.65</td>
      <td>17.16</td>
    </tr>
  </tbody>
</table>
</div>

<h3>2) Select 3–4 variables with your data set on which to perform a 50-50 train/test split.</h3>
<ul>
<li>Use scikit-learn.</li>
<li>Score and plot your predictions.</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">X_chosen</span> <span class="o">=</span> <span class="n">X</span><span class="p">[[</span><span class="s2">&quot;CRIM&quot;</span><span class="p">,</span><span class="s2">&quot;INDUS&quot;</span><span class="p">,</span><span class="s2">&quot;NOX&quot;</span><span class="p">,</span><span class="s2">&quot;RM&quot;</span><span class="p">]]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">split_score</span><span class="p">(</span><span class="n">X_chosen</span><span class="p">,</span> <span class="n">test_size</span><span class="p">):</span>
    <span class="n">X_chosen_train</span><span class="p">,</span> <span class="n">X_chosen_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_chosen</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="n">test_size</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_chosen_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>
    <span class="n">train_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_chosen_train</span><span class="p">)</span>
    <span class="n">test_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_chosen_test</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Y&quot;</span><span class="p">:</span><span class="n">y_test</span><span class="p">,</span>
                       <span class="s2">&quot;Y_hat&quot;</span><span class="p">:</span><span class="n">test_pred</span><span class="p">})</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span><span class="s2">&quot;Y_hat&quot;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_chosen_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;R Squared for training set is:&quot;</span><span class="p">,</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">train_pred</span><span class="p">),</span>
          <span class="s2">&quot;and R Squared for testing set is:&quot;</span><span class="p">,</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_pred</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">split_score</span><span class="p">(</span><span class="n">X_chosen</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nv">C</span>:\<span class="nv">Users</span>\<span class="nv">Minh</span>\<span class="nv">Anaconda3</span>\<span class="nv">lib</span>\<span class="nv">site</span><span class="o">-</span><span class="nv">packages</span>\<span class="nv">scipy</span>\<span class="nv">stats</span>\<span class="nv">stats</span>.<span class="nv">py</span>:<span class="mi">1713</span>: <span class="nv">FutureWarning</span>: <span class="nv">Using</span> <span class="nv">a</span> <span class="nv">non</span><span class="o">-</span><span class="nv">tuple</span> <span class="nv">sequence</span> <span class="k">for</span> <span class="nv">multidimensional</span> <span class="nv">indexing</span> <span class="nv">is</span> <span class="nv">deprecated</span><span class="c1">; use `arr[tuple(seq)]` instead of `arr[seq]`. In the future this will be interpreted as an array index, `arr[np.array(seq)]`, which will result either in an error or a different result.</span>
  <span class="k">return</span> <span class="nv">np</span>.<span class="nv">add</span>.<span class="nv">reduce</span><span class="ss">(</span><span class="nv">sorted</span>[<span class="nv">indexer</span>] <span class="o">*</span> <span class="nv">weights</span>, <span class="nv">axis</span><span class="o">=</span><span class="nv">axis</span><span class="ss">)</span> <span class="o">/</span> <span class="nv">sumval</span>


<span class="mi">0</span>.<span class="mi">6283050952617548</span>
<span class="nv">R</span> <span class="nv">Squared</span> <span class="k">for</span> <span class="nv">training</span> <span class="nv">set</span> <span class="nv">is</span>: <span class="mi">0</span>.<span class="mi">6283050952617548</span> <span class="nv">and</span> <span class="nv">R</span> <span class="nv">Squared</span> <span class="k">for</span> <span class="nv">testing</span> <span class="nv">set</span> <span class="nv">is</span>: <span class="mi">0</span>.<span class="mi">48870773942670076</span>
</pre></div>


<p><img alt="png" src="images/output_13_2.png" height = "42" width = "42"></p>
<h3>3) Try 70-30 and 90-10.</h3>
<ul>
<li>Score and plot.  </li>
<li>How do your metrics change?</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># 70/30</span>
<span class="n">split_score</span><span class="p">(</span><span class="n">X_chosen</span><span class="p">,</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nv">C</span>:\<span class="nv">Users</span>\<span class="nv">Minh</span>\<span class="nv">Anaconda3</span>\<span class="nv">lib</span>\<span class="nv">site</span><span class="o">-</span><span class="nv">packages</span>\<span class="nv">scipy</span>\<span class="nv">stats</span>\<span class="nv">stats</span>.<span class="nv">py</span>:<span class="mi">1713</span>: <span class="nv">FutureWarning</span>: <span class="nv">Using</span> <span class="nv">a</span> <span class="nv">non</span><span class="o">-</span><span class="nv">tuple</span> <span class="nv">sequence</span> <span class="k">for</span> <span class="nv">multidimensional</span> <span class="nv">indexing</span> <span class="nv">is</span> <span class="nv">deprecated</span><span class="c1">; use `arr[tuple(seq)]` instead of `arr[seq]`. In the future this will be interpreted as an array index, `arr[np.array(seq)]`, which will result either in an error or a different result.</span>
  <span class="k">return</span> <span class="nv">np</span>.<span class="nv">add</span>.<span class="nv">reduce</span><span class="ss">(</span><span class="nv">sorted</span>[<span class="nv">indexer</span>] <span class="o">*</span> <span class="nv">weights</span>, <span class="nv">axis</span><span class="o">=</span><span class="nv">axis</span><span class="ss">)</span> <span class="o">/</span> <span class="nv">sumval</span>


<span class="mi">0</span>.<span class="mi">5921891788230133</span>
<span class="nv">R</span> <span class="nv">Squared</span> <span class="k">for</span> <span class="nv">training</span> <span class="nv">set</span> <span class="nv">is</span>: <span class="mi">0</span>.<span class="mi">5921891788230133</span> <span class="nv">and</span> <span class="nv">R</span> <span class="nv">Squared</span> <span class="k">for</span> <span class="nv">testing</span> <span class="nv">set</span> <span class="nv">is</span>: <span class="mi">0</span>.<span class="mi">5191080836050675</span>
</pre></div>


<p><img alt="png" src="output_15_2.png"></p>
<p>The R squared is near each other</p>
<div class="highlight"><pre><span></span><span class="c1"># 90/10</span>
<span class="n">split_score</span><span class="p">(</span><span class="n">X_chosen</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nv">C</span>:\<span class="nv">Users</span>\<span class="nv">Minh</span>\<span class="nv">Anaconda3</span>\<span class="nv">lib</span>\<span class="nv">site</span><span class="o">-</span><span class="nv">packages</span>\<span class="nv">scipy</span>\<span class="nv">stats</span>\<span class="nv">stats</span>.<span class="nv">py</span>:<span class="mi">1713</span>: <span class="nv">FutureWarning</span>: <span class="nv">Using</span> <span class="nv">a</span> <span class="nv">non</span><span class="o">-</span><span class="nv">tuple</span> <span class="nv">sequence</span> <span class="k">for</span> <span class="nv">multidimensional</span> <span class="nv">indexing</span> <span class="nv">is</span> <span class="nv">deprecated</span><span class="c1">; use `arr[tuple(seq)]` instead of `arr[seq]`. In the future this will be interpreted as an array index, `arr[np.array(seq)]`, which will result either in an error or a different result.</span>
  <span class="k">return</span> <span class="nv">np</span>.<span class="nv">add</span>.<span class="nv">reduce</span><span class="ss">(</span><span class="nv">sorted</span>[<span class="nv">indexer</span>] <span class="o">*</span> <span class="nv">weights</span>, <span class="nv">axis</span><span class="o">=</span><span class="nv">axis</span><span class="ss">)</span> <span class="o">/</span> <span class="nv">sumval</span>


<span class="mi">0</span>.<span class="mi">5464009707318291</span>
<span class="nv">R</span> <span class="nv">Squared</span> <span class="k">for</span> <span class="nv">training</span> <span class="nv">set</span> <span class="nv">is</span>: <span class="mi">0</span>.<span class="mi">5464009707318291</span> <span class="nv">and</span> <span class="nv">R</span> <span class="nv">Squared</span> <span class="k">for</span> <span class="nv">testing</span> <span class="nv">set</span> <span class="nv">is</span>: <span class="mi">0</span>.<span class="mi">7729240461831992</span>
</pre></div>


<p><img alt="png" src="output_17_2.png"></p>
<p>For some reason the testing R Squared is higher than training =&gt; high bias ?</p>
<h3>4) Try k-folds cross-validation with k between 5–10 for your regression.</h3>
<ul>
<li>What seems optimal? </li>
<li>How do your scores change?  </li>
<li>What is the variance of scores like?</li>
<li>Try out different folds to get a sense of how this impacts your score.</li>
</ul>
<div class="highlight"><pre><span></span><span class="n">X_chosen_train</span><span class="p">,</span> <span class="n">X_chosen_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_chosen</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">):</span>
    <span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_chosen_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">kf</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="mi">0</span><span class="p">.</span><span class="mi">544615272421715</span>
<span class="mi">0</span><span class="p">.</span><span class="mi">5212957979454679</span>
<span class="mi">0</span><span class="p">.</span><span class="mi">5036171339273199</span>
<span class="mi">0</span><span class="p">.</span><span class="mi">47673453328432447</span>
<span class="mi">0</span><span class="p">.</span><span class="mi">4818417904902898</span>
<span class="mi">0</span><span class="p">.</span><span class="mi">49807733868024</span>
</pre></div>


<h3>5) [Bonus] Optimize the $R^2$ score.</h3>
<p>Can you optimize your $R^2$ by selecting the best features and validating the model using either train/test split or k-folds?</p>
<p>Your code will need to iterate through the different combinations of predictors, cross-validate the current model parameterization, and determine which set of features performed best.</p>
<p>The number of k-folds is up to you.</p>
<blockquote>
<p><em>Hint:</em> The <code>itertools</code> package is useful for combinations and permutations.</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="nb">list</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="mi">2</span><span class="p">))[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;CRIM&#39;</span><span class="p">,</span> <span class="s1">&#39;INDUS&#39;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="mi">13</span>
</pre></div>


<h3>5.1) Explain what could be wrong with this approach.</h3>
<ul>
<li>The higher the number of features, the higher you R squared</li>
</ul>
<h3>6) [Bonus] Explore another target variable and practice Patsy formulas.</h3>
<p>Can you find another response variable, given a combination of predictors, that can be predicted accurately through the exploration of different predictors in this data set?</p>
<p><strong>Try using Patsy to construct your target and predictor matrices from formula strings.</strong></p>
<blockquote>
<p><em>Tip: Check out pairplots, coefficients, and Pearson scores.</em></p>
</blockquote>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">patsy</span>

<span class="c1"># A:</span>
</pre></div>
 </div>
</div>
 </div>
</body>
</html>
